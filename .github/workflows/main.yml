name: cicd-demo
on:
  push:
    branches:
      - 'migrate_to_oracle_cloud'
      - 'master'
jobs:
  build-job:
    name: Build Job
    runs-on: ubuntu-latest
    steps:
      - name: 'Deploy'
        uses: appleboy/ssh-action@v0.1.4
        with:
          host: ${{ secrets.VM_SSH_HOST }}
          username: ${{ secrets.VM_SSH_USER }}
          key: ${{ secrets.VM_SSH_PRIVATE_KEY }}
          script: |
            docker build -t scala-bot-image:latest .
            docker stop scala-bot
            docker rm scala-bot
            docker run -e MONGODB_URI='${{ secrets.MONGODB_URI }}' \
            -e MONGODB_DATABASE_NAME='${{ secrets.MONGODB_DATABASE_NAME }}' \
            -e LOG_CHANNEL='${{ secrets.LOG_CHANNEL }}' \
            -e GOOGLEAPIS_CREDENTIALS='${{ secrets.GOOGLEAPIS_CREDENTIALS }}' \
            -e FILES_CHANNEL_ID='${{ secrets.FILES_CHANNEL_ID }}' \
            -e BOT_TOKEN='${{ secrets.BOT_TOKEN }}' \
            -e FILES_CHANNEL_ID='${{ secrets.FILES_CHANNEL_ID }}' \
            -e HOST='{{ secrets.HOST }}' \
            --publish 8080:8080 scala-bot
